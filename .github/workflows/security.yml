name: Workflows generated by the MVS plan
on:
  workflow_dispatch:
    inputs:
       client_payload:
          description: The Client payload
          required: true
jobs:
  static-code-analysis-python:
    if: contains( fromJSON(github.event.inputs.client_payload).payload.control_ids, '544911b5-b570-44e2-96ca-41036a5074ff') || fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-python'
    runs-on: ubuntu-latest
    steps:
    - name: python-code-scanning
      uses: jitsecurity-controls/jit-github-action@v1.6
      with:
        docker_user: jit-bot
        docker_password: Z2hwX1JrdUpqZk5QTk5XWmpzVDRZb0J0Z3ZCNnBJOGtNMDNBbDlzMAo=
        security_control: ghcr.io/jitsecurity-controls/control-bandit-slim:latest
        security_control_args: -r /code -f json -q -ll -iii
        security_control_output_file: /tmp/report.json
        dispatch_type: workflow

  static-code-analysis-js:
    if: contains( fromJSON(github.event.inputs.client_payload).payload.control_ids, '3be2887f-aebc-4d57-8247-343e93b5625e') || fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-js'
    runs-on: ubuntu-latest
    steps:
    - name: semgrep-code-scanning
      uses: jitsecurity-controls/jit-github-action@v1.6
      with:
        docker_user: jit-bot
        docker_password: Z2hwX1JrdUpqZk5QTk5XWmpzVDRZb0J0Z3ZCNnBJOGtNMDNBbDlzMAo=
        security_control: ghcr.io/jitsecurity-controls/control-semgrep-alpine:latest
        security_control_args: --json --config=/semgrep-config.yml --metrics=off --severity=ERROR /code
        
        dispatch_type: workflow

  static-code-analysis-go:
    if: contains( fromJSON(github.event.inputs.client_payload).payload.control_ids, '47b3a8fe-f91c-4a4d-82f6-ee7ead1fe6bb') || fromJSON(github.event.inputs.client_payload).payload.workflow_job_name == 'static-code-analysis-go'
    runs-on: ubuntu-latest
    steps:
    - name: golang-code-scanning
      uses: jitsecurity-controls/jit-github-action@v1.6
      with:
        docker_user: jit-bot
        docker_password: Z2hwX1JrdUpqZk5QTk5XWmpzVDRZb0J0Z3ZCNnBJOGtNMDNBbDlzMAo=
        security_control: ghcr.io/jitsecurity-controls/control-gosec-alpine:latest
        security_control_args: -fmt=json -severity=high /code/...
        
        dispatch_type: workflow
